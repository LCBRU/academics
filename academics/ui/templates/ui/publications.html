{% extends "ui/page.html" %}
{% from "lbrc_flask/form_macros.html" import render_search, render_pagination, render_button_bar, pagination_summary %}
{% from "lbrc_flask/modal_macros.html" import render_modal %}

{% block content %}
<section>
    <div class="page-header">
        <h1>Publications</h1>

        {{ render_search(
            search_form,
            'ui.publications',
            placeholder='enter search text - searches title and publication',
            buttons=[
                {
                    'id': 'export',
                    'text': 'Excel',
                    'endpoint': 'ui.publication_export_xlsx',
                    'add_form_fields': True,
                },
                {
                    'id': 'export',
                    'text': 'PDF',
                    'endpoint': 'ui.publication_export_pdf',
                    'add_form_fields': True,
                },
            ],
        ) }}

    </div>

    {{ pagination_summary(publications, 'publication') }}

    <ul class="list-group">
        {% for p in publications.items %}
            <li class="list-group-item summary_details">
                <div class='row'>
                    <div class="col-7">
                        <div>
                            <h3>{{p.title}}</h3>
                            <h4>{{p.author_list}}</h4>
                            <h5>{{p.journal.name | title_case}} ({{p.publication_cover_date | date_format}})</h5>
                        </div>
                    </div>
                    <div class="col-5">
                        <a href="{{ p.href }}" class="btn btn-primary" target="_blank" title="View on Scopus"><i class="fas fa-external-link-square-alt"></i></a>
                        {% if p.doi %}
                            <a href="http://doi.org/{{ p.doi }}"class="btn btn-outline-primary" target="_blank" title="View publication"><i class="fas fa-file-alt"></i></a>
                        {% endif %}
                    </div>
                </div>
                <div>
                    <h4>Keywords:</h4>
                    {% for k in p.keywords | sort(attribute='keyword')%}
                        <a href="{{ url_for('ui.publications', keywords=k.id ) }}" class="m-1 btn btn-outline-secondary btn-sm">{{ k.keyword }}</a>
                    {% endfor %}
                </div>
            </li>
        {% endfor %}
    </ul>
</section>

{{ render_pagination(publications, 'ui.publications', form=search_form) }}

{% endblock %}
